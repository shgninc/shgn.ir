<!DOCTYPE html>
<html lang="en">
<head>
    <!— Global site tag (gtag.js) - Google Analytics —>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124515881-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-124515881-2');

    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title> پرش با SSH - دست نوشته های یک تازه کار </title>
    <meta name="description"
          content="یک راهکار جایگزین برای ssh tunneling."/>
    <meta name="keywords"
          content="لینوکس،لینوکس مشهد،آموزش,پایتون,پایتون مشهد,آموزش لینوکس,دیتابیس,آموزش دیتابیس,برنامه نویسی,linux,database,mysql,mariadb,datamart,galera cluster,apache,big data,dataware house,cluster,galera,percona,python,php,tutorial,debian,ubuntu,centos,arch linux,mashhad linux,iran linux,debian mashhad, ssh, linux"/>

    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <!--    <link href="https://rawgit.com/richleland/pygments-css/master/github.css" rel="stylesheet" crossorigin="anonymous">-->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
    body {
      direction: rtl;
      font-family: Vazirmatn, sans-serif;
      background-color: rgba(226,232,240,.8)
    }
    p {
        font-size: 1.3em;
        line-height: 1.5em;
        text-align: justify;
      }
    p img {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    .header {
        margin-top: 150px;
        text-align: center;
    }
    .header h1{
        text-align: center;
        font-size: 50px;
        margin: 0;
        font-family: 'Inter';
    }
    .counter-box {
      width: 350px;
    }
    .counter-box h2 {
      font-size: 60px;
      margin-right: 90px;
    }
    .counter-box p{
        text-align: center;
      font-family: arial;
    }
    pre {
        direction: ltr;
        border-left: 5px solid #6ce26c;
      }
    .panel-body {
        padding: 10px 0;
    }
    .panel-body ul li{
        margin: 5px 0;
    }
    a {
        color: #4608ad;
      }
    .panel-group .panel {
        margin-bottom: 5px;
        border-radius: 1.1rem
    }
    .panel-primary > .panel-heading {
        background-color: #4608ad;
        border-radius: 1.1rem
    }
    .navbar-default {
        background-color: #4608ad;
    }
    .navbar-default .navbar-brand {
        color: #ffffff;
    }
    .navbar-default .navbar-nav > li > a {
        color: #ffffff;
        font-size:initial;
    }
    .navbar-default .navbar-nav > li > a:hover{
        color: #00ffd9;
    }
    .navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:focus, .navbar-default .navbar-nav > .open > a:hover{
        color: #4608ad;
    }

    .dropdown-menu{
        background-color: #4608ad;
        color:#ffffff;
        font-size:initial;
    }
    .dropdown-menu > li > a{
        color:#ffffff;
        font-size:initial;
    }
    .dropdown-menu > li > a:hover{
        color: #00ffd9;
        background-color:#4608ad;
    }

    #back2Top {
    width: 40px;
    line-height: 40px;
    overflow: hidden;
    z-index: 999;
    display: none;
    cursor: pointer;
    -moz-transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
    transform: rotate(270deg);
    position: fixed;
    bottom: 50px;
    right: 0;
    background-color: #DDD;
    text-align: center;
    font-size: 30px;
    text-decoration: none;
    }
    #back2Top:hover {
        background-color: #DDF;
        color: #000;
    }
    </style>
</head>
<body>

<a id="top"></a>
<div id="scroollto1"></div>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header navbar-right">
            <a class="navbar-brand" href="/">دست نوشته های یک تازه کار</a>
        </div>
        <ul class="nav navbar-nav navbar-right">
            
            
            <li><a href="https://shgn.ir/about.html" title="درباره ما">درباره ما</a></li>
            
            <li><a href="https://shgn.ir/contacus.html" title="ارتباط با ما">ارتباط با ما</a></li>
            
            <li><a href="https://shgn.ir/links.html" title="لینک های مفید">لینک های مفید</a></li>
            
            <li><a href="https://shgn.ir/tag/database.html" title="دیتابیس">دیتابیس</a></li>
            
            <li><a href="https://shgn.ir/tag/linux.html" title="لینوکس">لینوکس</a></li>
            
            <li class="dropdown">
                <a href="https://shgn.ir/tag/learn.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                   aria-expanded="false">آموزش <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="https://shgn.ir/tag/lpic1.html">دوره LPIC1</a></li>
                </ul>
            </li>
            
        </ul>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-9">
            
    <div itemscope itemtype="http://schema.org/NewsArticle">
    <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="http://https://shgn.ir/2020-09-26/ssh-jumping-hosts.html"/>
    <div class="page-header">
      <h3 itemprop="name">پرش با SSH</h3>
      
      
        <small>
          <p class="text-right">
            ارسال شده <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                توسط <span itemprop="name">سید سجاد شاهچراغیان</span>
              </span>
              در تاریخ <span itemprop="datePublished">2020-09-26</span>
          </p>
        </small>
      
    </div>
      <section itemprop="articleBody">
        <p>برای مدیریت و دسترسی از راه دور به سرورهای لینوکسی، یک راهکار قدرتمند و بسیار ساده به نام <code>ssh</code> وجود دارد. این مطلب با فرض آشنایی شما با <code>ssh</code> و <code>ssh tunneling</code> نوشته شده است.</p>
<p>ابتدا باید این توضیح داده شود که، به دلیل ایجاد امنیت هر چه بیشتر برای سرورها در یک شبکه، معمولا آن ها را در شبکه پشت یک <code>gateway</code> قرار می دهند تا دسترسی از بیرون(اینترنت) و مستقیم برای هر کسی ممکن نباشد. اما برای مدیریت و کنترل آن سرورها، معمولا راهی را از طریق گیتوی یاد شده ایجاد می کنند. کاربران برای ارتباط با آن سرورها می توانند با <code>ssh</code> زدن به گیتوی و سپس از آنجا <code>ssh</code> به سرور هدف، به آن وصل شوند. به نوعی این کار، جایگزین <code>ssh tunneling</code> هم می تواند باشد.  </p>
<p>ایده اصلی این راه، استفاده از <code>ProxyCommand</code> برای اجرا خودکار دستور <code>ssh</code> روی سرور هدف با استفاده از هاست واسط و انتقال کل ترافیک آن از این طریق می باشد.</p>
<p><img alt="Image  SSH jump host" src="/2020-09-26/SSH-Jump-Host.png" /> </p>
<h1>پیشنیاز ها</h1>
<ul>
<li>دسترسی <code>ssh</code> به هاست گیتوی و شبکه داخلی آن</li>
<li>نصب بودن بسته <code>Netcat</code> روی هاست گیتوی</li>
</ul>
<h1>پرش داینامیک ssh</h1>
<p>برای پرش از طریق هاست گیتوی باید از گزینه <code>-J</code> به ترتیب زیر استفاده نمود:</p>
<div class="codehilite"><pre><span></span><code>user $ssh -J host1 host2
</code></pre></div>

<p>اگر نام کاربری یا شماره پورت روی ماشین هدف تفاوت دارد می توانید به این ترتیب آن ها را تعیین کنید:</p>
<div class="codehilite"><pre><span></span><code><span class="k">user</span><span class="w"> </span><span class="err">$</span><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">J</span><span class="w"> </span><span class="n">user1</span><span class="nv">@host1</span><span class="err">:</span><span class="n">port1</span><span class="w"> </span><span class="n">user2</span><span class="nv">@host2</span><span class="err">:</span><span class="n">port2</span>
</code></pre></div>

<h3>چندین پرش</h3>
<p>با دستوری شبیه به دستورات قبلی، نیز می توان برای پرش از چندین هاست تا سرور هدف استفاده نمود:</p>
<div class="codehilite"><pre><span></span><code><span class="k">user</span><span class="w"> </span><span class="err">$</span><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">J</span><span class="w"> </span><span class="n">user1</span><span class="nv">@host1</span><span class="err">:</span><span class="n">port1</span><span class="p">,</span><span class="n">user2</span><span class="nv">@host2</span><span class="err">:</span><span class="n">port2</span><span class="w"> </span><span class="n">user3</span><span class="nv">@host3</span>
</code></pre></div>

<p># پرش استاتیک ssh</p>
<p>در این روش شما تنظیمات را درون فایل تنظیمات <code>ssh</code> انجام می دهید. برای این مهم لازم هست تا اطلاعات مربوط به هاست یا هاست های واسط تا سرور هدف را داشته باشید. سپس می توانید مسیریابی استاتیک برای پرش را در فایل تنظیمات <code>ssh</code> انجام دهید. تفاوت این روش با روش داینامیک در این است که، نیازی به ایجاد فایل تنظیمات <code>.ssh</code> روی هاست های واسط و سرور هدف نیست.  </p>
<p>### نحوه تنظیم </p>
<p>در فایل به مسیر <code>~/.ssh/config</code> تنظیمات زیر را اعمال می کنید:</p>
<div class="codehilite"><pre><span></span><code>### First jumphost. Directly reachable
Host betajump
    HostName jumphost1.example.org

### Host to jump to via jumphost1.example.org
Host behindbeta
    HostName behindbeta.example.org
    ProxyJump  betajump
</code></pre></div>

<p>### نحوه استفاده </p>
<p>نحوه استفاده به سادگی زیر می باشد:</p>
<div class="codehilite"><pre><span></span><code>user $ssh behindalpha
</code></pre></div>

<p>اگر نام کاربری روی هاست ها متفاوت بود، کافی هست تا آن را در خط مربوط به <code>ProxyJump</code> در فایل <code>~/.ssh/config</code> تعیین نمایید:</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">ProxyJump</span><span class="w">  </span><span class="n">otheruser</span><span class="nv">@behindalpha</span>
</code></pre></div>

<p>### چندین پرش </p>
<p>برای استفاده از چندین هاست واسط و پرش ازآنها شبیه به تنظیمات قبل، می توان در مسیر فایل <code>~/.ssh/config</code> تنظیم نمود:</p>
<div class="codehilite"><pre><span></span><code>### First jumphost. Directly reachable
Host alphajump
    HostName jumphost1.example.org

### Second jumphost. Only reachable via jumphost1.example.org
Host betajump
  HostName jumphost2.example.org
  ProxyJump alphajump

### Host only reachable via alphajump and betajump
Host behindalphabeta
  HostName behindalphabeta.example.org
  ProxyJump betajump
</code></pre></div>

<p>همچنین برای استفاده نیز همانند قبل دستور زیر کافی می باشد:</p>
<div class="codehilite"><pre><span></span><code>user $ssh behindalphabeta
</code></pre></div>

<h1>منابع:</h1>
<ul>
<li><a href="https://wiki.gentoo.org/wiki/SSH_jump_host"> SSH jump host </a></li>
<li><a href="https://glandium.org/blog/?p=308">Following up on SSH through jump hosts</a></li>
<li><a href="https://www.tecmint.com/access-linux-server-using-a-jump-host/">How to Access a Remote Server Using a Jump Host</a></li>
</ul>
      </section>
      <div>
        برچسب ها:
      
        <a href="/tag/ssh.html">
            <span class="label label-default" itemprop="about">ssh</span>
        </a>
      
        <a href="/tag/linux.html">
            <span class="label label-default" itemprop="about">linux</span>
        </a>
      
    </div>
    </div>

        </div>
        <div class="col-md-3">
            <div class="panel-group">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        من در stackexchange.com
                    </div>
                    <div class="panel-body">
                        <div class="col-md-3 col-md-offset-9">
                            <a href="https://stackexchange.com/users/887576" target="_blank">
                                <img src="https://stackexchange.com/users/flair/887576.png" width="208" height="58"
                                     alt="profile for shgnInc on Stack Exchange, a network of free, community-driven Q&A sites"
                                     title="profile for shgnInc on Stack Exchange, a network of free, community-driven Q&A sites">
                            </a>
                        </div>
                    </div>
                </div>
                <div class="panel-group">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        مطالب نوشته شده تا کنون
                    </div>
                    <div class="panel-body">
                            <div class="counter-box">
                                <h2>
                                    <span class="count">52</span>
                                </h2>
                            </div>
                    </div>
                </div>

                <div class="panel-group">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            مطالب مهم
                        </div>
                        <div class="panel-body">
                            <ul>
                                <li><a href="https://shgn.ir/2021-03-07/galera-cluster-debian-10.html"
                                       title="نصب Galer Cluster بر روی debian 10">نصب Galer Cluster بر روی debian 10</a>
                                </li>
                                <li><a href="https://shgn.ir/2020-08-15/installing_docker_on_debian.html"
                                       title="نصب Docker روی Debian 10">نصب Docker روی Debian 10</a></li>
                                <li><a href="https://shgn.ir/2018-09-05/Mysql-JSON-DataType.html"
                                       title="معرفی نوع داده JSON در دیتابیس Mysql-Mariadb">معرفی نوع داده JSON در
                                    دیتابیس Mysql-Mariadb</a></li>
                                <li><a href="https://shgn.ir/2018-07-23/ssh_automatic_login.html"
                                       title="لاگین خودکار با SSH">لاگین خودکار با SSH</a></li>
                                <li><a href="https://shgn.ir/2017-08-16/galera_cluster.html"
                                       title="نصب Galer Cluster بر روی debian8">نصب Galer Cluster بر روی debian8</a>
                                </li>
                                <li><a href="https://shgn.ir/2022-07-02/mysql-slave-replicaion.html"
                                       title="راه اندازی Mysql/Mariadb Slave Replication بدون توقف">راه اندازی Mysql/Mariadb Slave Replication بدون توقف</a>
                                </li>
                                <li><a href="https://shgn.ir/2023-12-03/Using-all-CPU-with-tar.html"
                                       title="فشرده سازی با استفاده از تمام ظرفیت CPU">فشرده سازی با استفاده از تمام ظرفیت CPU</a>
                                </li>
                                <li><a href="https://shgn.ir/2022-10-22/reduce-LVM-Partition-size.html"
                                       title="کاهش فضای دیسک LVM">کاهش فضای دیسک LVM</a>
                                </li>
                                <li><a href="https://shgn.ir/2023-12-03/Using-all-CPU-with-tar.html"
                                       title="فشرده سازی با استفاده از تمام ظرفیت CPU">فشرده سازی با استفاده از تمام ظرفیت CPU</a>
                                </li>
                            </ul>

                        </div>
                    </div>
                </div>

                <div class="panel-group">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            تازه ترین مطالب
                        </div>
                        <div class="panel-body">
                            <ul>
                                
                            </ul>

                        </div>
                    </div>


                </div>

                <div class="panel-group">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Linux ISO Images
                        </div>
                        <div class="panel-body">
                            <ul>
                                <li><a href="https://shgn.ir/images/gparted-live-1.1.0-1-amd64.iso"
                                       title="gparted-live-1.1.0-1-amd64">GParted Live CD/USB/HD/PXE Bootable Image</a></li>
                                <li><a href="https://shgn.ir/images/debian-10.3.0-amd64-xfce-CD-1.iso"
                                       title="debian-10.3.0-amd64-xfce-CD-1">Debian-10-amd64-xfce-CD</a></li>
                                <li><a href="https://shgn.ir/images/SNG7-PBX16-64bit-2302-1.iso"
                                       title="FreePBX16-64bit-2302-1">FreePBX16-64bit-2302-1</a></li>
                                <li><a href="https://shgn.ir/images/debian-12.2.0-amd64-netinst.iso"
                                       title="debian-12.2.0-amd64-netinst.iso">debian-12.2.0-amd64-netinst</a></li>
                                <li><a href="https://shgn.ir/images/debian-live-12.2.0-amd64-xfce.iso"
                                       title="debian-live-12.2.0-amd64-xfce">debian-live-12.2.0-amd64-xfce</a></li>
                                <li><a href="https://shgn.ir/images/ubuntu-22.04.3-desktop-amd64.iso"
                                       title="ubuntu-22.04.3-desktop-amd64">Ubuntu Desktop</a></li>
                                <li><a href="https://shgn.ir/images/ubuntu-22.04.3-live-server-amd64.iso"
                                       title="ubuntu-22.04.3-live-server-amd64">Ubuntu Server</a></li>
                                <li><a href="https://shgn.ir/images/CentOS-7-aarch64-Minimal-1908.iso"
                                       title="CentOS-7-aarch64-Minimal-1908">CentOS-7-aarch64-Minimal-1908</a></li>
                                <li><a href="https://shgn.ir/images/CentOS-8.2.2004-x86_64-minimal.iso"
                                       title="CentOS-8.2.2004-x86_64-minimal">CentOS-8.2.2004-x86_64-minimal</a></li>
                                <li><a href="https://shgn.ir/images/clonezilla-live-3.1.1-27-amd64.iso"
                                       title="clonezilla-live-3.1.1-27-amd64">clonezilla-live</a></li>
                            </ul>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<hr/>
<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                
                <strong>پیشنهادی های</strong>
                <ul>
                    
                    <li><a href="https://github.com/shgninc">GitHub</a></li>
                    
                    <li><a href="https://www.instagram.com/shgninc/">Instagram</a></li>
                    
                    <li><a href="https://virgool.io/@shgninc">Virgool</a></li>
                    
                    <li><a href="https://www.linkedin.com/in/sajjad-shahcheraghean/">Linkedin</a></li>
                    
                    <li><a href="https://twitter.com/shahcheraghian">Twiteer</a></li>
                    
                    <li><a href="https://virasty.com/twitter">Virsty</a></li>
                    
                    <li><a href="https://shgn.ir/yii2/">معرفی Yii2</a></li>
                    
                </ul>
                
            </div>
            <div class="col-md-6">
                <strong>دسترسی های ساده</strong>
                <ul>
                    <li><a href="/">تمامی پست ها</a></li>
                    <li><a href="/tags.html">فهرست تگ ها</a></li>
                    <li><a href="/tag/video.html">ویدیوها</a></li>
                </ul>
            </div>
            <div class="col-md-12">
                <p class="text-center"><small>https://shgn.ir &copy; 2023</small></p>
            </div>
        </div>
    </div>
</footer>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://shgn.ir/static/jquery/3.5.1/jquery.min.js"></script>
<script src="https://shgn.ir/static/jquery/3.5.1/app.js"></script>
<script src="https://shgn.ir/static/ProngnRoll/prognroll.min.js"></script>
<script>
var jQ_3_5_1 = jQuery.noConflict(true);

    /*Scroll to top when arrow up clicked BEGIN*/
jQ_3_5_1(window).scroll(function() {
    var height = jQ_3_5_1(window).scrollTop();
    if (height > 100) {
        jQ_3_5_1('#back2Top').fadeIn();
    } else {
        jQ_3_5_1('#back2Top').fadeOut();
    }
});
jQ_3_5_1(document).ready(function() {
    jQ_3_5_1("#back2Top").click(function(event) {
        event.preventDefault();
        jQ_3_5_1("html, body").animate({ scrollTop: 0 }, "slow");
        return false;
    });
});
 /*Scroll to top when arrow up clicked END*/

/* https://www.jqueryscript.net/other/jQuery-Scroll-Progress-Indicator-For-Any-Containers-ProngnRoll.html */

jQ_3_5_1("body").prognroll({
  position:"bottom",
  height:5,
  color:"#f54905"
});

</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
        integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
        crossorigin="anonymous"></script>

<a id="back2Top" title="Back to top" href="#">&#10148;</a>
</body>
</html>